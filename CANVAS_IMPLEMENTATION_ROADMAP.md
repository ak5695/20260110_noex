# å›¾æ–‡è”åŠ¨ç³»ç»Ÿ - å®ç°è·¯çº¿å›¾

## âœ… å·²å®Œæˆ

### 1. æ•°æ®åº“ Schemaï¼ˆ100%ï¼‰
- âœ… Canvas å­˜å‚¨å±‚
- âœ… å¤åˆèŠ‚ç‚¹è¡¨ç»“æ„
- âœ… æ–‡æ¡£-ç”»å¸ƒç»‘å®š
- âœ… å˜æ›´æ—¥å¿—ï¼ˆCRDTæ”¯æŒï¼‰
- âœ… åä½œä¼šè¯è¿½è¸ª
- âœ… å®Œæ•´çš„ç´¢å¼•ä¼˜åŒ–

**æ–‡ä»¶**: `db/canvas-schema.ts`, `drizzle/0002_add_canvas_schema.sql`

### 2. æ‹–æ‹½ç³»ç»Ÿï¼ˆ100%ï¼‰âœ¨ ğŸ‰
- âœ… ç±»å‹ç³»ç»Ÿå®šä¹‰ (`drag-drop-types.ts`)
- âœ… æ‹–æ‹½æ¡¥æ¥å™¨ (`drag-drop-bridge.ts`)
- âœ… å¯æ‹–æ‹½ç»„ä»¶ (`draggable-content.tsx`)
  - DraggableContent (åŸºç¡€ç»„ä»¶)
  - DraggableText (æ–‡æœ¬é€‰åŒº)
  - DraggableBlock (å®Œæ•´å—)
  - DraggableSemanticNode (è¯­ä¹‰èŠ‚ç‚¹)
- âœ… Canvas æ”¾ç½®åŒº (`canvas-drop-zone.tsx`)
- âœ… å¢å¼ºçš„ Excalidraw (`enhanced-excalidraw.tsx`)
- âœ… æ‹–æ‹½é¢„è§ˆç»„ä»¶ (`drag-preview.tsx`)
- âœ… Server Actions (åˆ›å»ºç»‘å®šã€ä¿å­˜å…ƒç´ )
- âœ… Canvas ç®¡ç† Actions (`canvas.ts`)
- âœ… è‡ªåŠ¨å…ƒç´ æ ·å¼åŒ–ï¼ˆæ ¹æ®æºç±»å‹ï¼‰
- âœ… è§†è§‰åé¦ˆï¼ˆè¾¹æ¡†é«˜äº®ã€å…‰æ ‡æŒ‡ç¤ºå™¨ï¼‰
- âœ… **Shift+æ‹–æ‹½æ–‡æœ¬é€‰åŒº** (`use-text-drag.ts`)
- âœ… **ç”¨æˆ·æç¤ºç»„ä»¶** (`drag-hint.tsx`)
- âœ… **ç¼–è¾‘å™¨é›†æˆå®Œæˆ** (`editor.tsx`)

**æ–‡ä»¶**:
- `lib/canvas/drag-drop-types.ts` (150è¡Œ)
- `lib/canvas/drag-drop-bridge.ts` (250è¡Œ)
- `components/canvas/draggable-content.tsx` (205è¡Œ)
- `components/canvas/canvas-drop-zone.tsx` (150è¡Œ)
- `components/canvas/enhanced-excalidraw.tsx` (120è¡Œ)
- `components/canvas/drag-preview.tsx` (100è¡Œ)
- `components/editor-drag-handler.tsx` (230è¡Œ)
- `components/drag-hint.tsx` (100è¡Œ)
- `hooks/use-text-drag.ts` (180è¡Œ)
- `actions/canvas-bindings.ts` (180è¡Œ)
- `actions/canvas.ts` (80è¡Œ)
- `components/excalidraw-canvas.tsx` (å·²æ›´æ–°)
- `components/editor.tsx` (å·²æ›´æ–°)

**æ€»ä»£ç é‡**: ~1,745è¡Œ

**å®Œæˆæ—¥æœŸ**: 2026-01-12

**ä½¿ç”¨æ–¹æ³•**:
1. åœ¨ç¼–è¾‘å™¨ä¸­é€‰ä¸­æ–‡å­—ï¼ˆ5ä¸ªå­—ç¬¦ä»¥ä¸Šï¼‰
2. æŒ‰ä½ **Shift** é”®
3. æ‹–æ‹½é€‰ä¸­çš„æ–‡å­—åˆ°å³ä¾§ç”»å¸ƒ
4. æ¾å¼€é¼ æ ‡ï¼Œè‡ªåŠ¨åˆ›å»ºå¯è§†åŒ–å…ƒç´ å’Œç»‘å®šå…³ç³»

---

## ğŸš§ å¾…å®ç°æ¨¡å—

### 2. å¤åˆèŠ‚ç‚¹ç®¡ç†å™¨ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~800 è¡Œ

**åŠŸèƒ½**:
- åˆ›å»ºå¤åˆèŠ‚ç‚¹ï¼ˆå¤šé€‰å…ƒç´  â†’ ç»„åˆï¼‰
- ç§»åŠ¨å¤åˆèŠ‚ç‚¹ï¼ˆä¿æŒå†…éƒ¨ç›¸å¯¹ä½ç½®ï¼‰
- æ‹†åˆ†å¤åˆèŠ‚ç‚¹
- åµŒå¥—å¤åˆèŠ‚ç‚¹æ”¯æŒ
- è¾¹ç•Œæ¡†è‡ªåŠ¨è®¡ç®—

**æ–‡ä»¶ç»“æ„**:
```
lib/canvas/
  â”œâ”€â”€ compound-node-manager.ts  (æ ¸å¿ƒé€»è¾‘)
  â”œâ”€â”€ spatial-calculator.ts     (ç©ºé—´è®¡ç®—)
  â””â”€â”€ compound-types.ts         (ç±»å‹å®šä¹‰)

actions/
  â”œâ”€â”€ compound-nodes.ts         (Server Actions)
```

---

### 3. ç”»å¸ƒå…ƒç´ å­˜å‚¨ APIï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~600 è¡Œ

**åŠŸèƒ½**:
- å¢é‡æ›´æ–° API
- æ‰¹é‡æ“ä½œä¼˜åŒ–
- åˆ†å—åŠ è½½ï¼ˆå¤§ç”»å¸ƒï¼‰
- ç‰ˆæœ¬æ§åˆ¶å’Œå†²çªè§£å†³

**æ–‡ä»¶ç»“æ„**:
```
actions/
  â”œâ”€â”€ canvas-elements.ts        (CRUDæ“ä½œ)
  â”œâ”€â”€ canvas-sync.ts            (åŒæ­¥é€»è¾‘)

lib/canvas/
  â”œâ”€â”€ element-storage.ts        (å­˜å‚¨å±‚)
  â”œâ”€â”€ chunking-strategy.ts      (åˆ†å—ç­–ç•¥)
```

---

### 4. æ–‡æ¡£-ç”»å¸ƒç»‘å®šç³»ç»Ÿï¼ˆä¼˜å…ˆçº§ï¼šæœ€é«˜ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~1000 è¡Œ

**åŠŸèƒ½**:
- åˆ›å»º/åˆ é™¤ç»‘å®š
- åŒå‘åŒæ­¥ï¼ˆæ–‡æ¡£ â†” ç”»å¸ƒï¼‰
- ç»‘å®šçŠ¶æ€æ›´æ–°
- é«˜äº®å’Œè§†è§‰åé¦ˆ

**æ–‡ä»¶ç»“æ„**:
```
lib/canvas/
  â”œâ”€â”€ binding-manager.ts        (ç»‘å®šæ ¸å¿ƒ)
  â”œâ”€â”€ sync-engine.ts            (åŒæ­¥å¼•æ“)
  â”œâ”€â”€ binding-types.ts          (ç±»å‹å®šä¹‰)

actions/
  â”œâ”€â”€ canvas-bindings.ts        (Server Actions)

hooks/
  â”œâ”€â”€ use-canvas-binding.ts     (React Hook)
```

---

### 5. ~~æ‹–æ‹½ç³»ç»Ÿ~~ âœ… å·²å®Œæˆ
è¯¦è§ä¸Šæ–¹"å·²å®Œæˆ"éƒ¨åˆ†

---

### 6. äººç±»è£å†³é›†æˆï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~500 è¡Œ

**åŠŸèƒ½**:
- AI ç”Ÿæˆç»‘å®šçš„å®¡æ ¸æµç¨‹
- æ‰¹å‡†/æ‹’ç»/ä¿®æ”¹ç•Œé¢
- è£å†³å†å²è¿½è¸ª

**æ–‡ä»¶ç»“æ„**:
```
components/canvas/
  â”œâ”€â”€ arbitration-panel.tsx     (è£å†³é¢æ¿)
  â”œâ”€â”€ binding-review-card.tsx   (ç»‘å®šå®¡æ ¸å¡ç‰‡)

actions/
  â”œâ”€â”€ arbitration.ts            (è£å†³ Actions)
```

---

### 7. å®æ—¶åä½œï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~900 è¡Œ

**åŠŸèƒ½**:
- WebSocket è¿æ¥ç®¡ç†
- å…‰æ ‡ä½ç½®å…±äº«
- å¢é‡æ›´æ–°å¹¿æ’­
- å†²çªè§£å†³ï¼ˆCRDTï¼‰

**æ–‡ä»¶ç»“æ„**:
```
lib/realtime/
  â”œâ”€â”€ websocket-server.ts       (WebSocketæœåŠ¡)
  â”œâ”€â”€ crdt-manager.ts           (CRDTé€»è¾‘)
  â”œâ”€â”€ session-manager.ts        (ä¼šè¯ç®¡ç†)

app/api/ws/
  â””â”€â”€ canvas/
      â””â”€â”€ route.ts              (WebSocket Route)
```

---

### 8. Excalidraw é›†æˆå±‚ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~600 è¡Œ

**åŠŸèƒ½**:
- Excalidraw äº‹ä»¶ç›‘å¬
- å…ƒç´ å˜æ›´æ•è·
- è‡ªå®šä¹‰å·¥å…·æ 
- ç”»å¸ƒçŠ¶æ€åŒæ­¥

**æ–‡ä»¶ç»“æ„**:
```
components/canvas/
  â”œâ”€â”€ excalidraw-wrapper.tsx    (Excalidrawå°è£…)
  â”œâ”€â”€ canvas-toolbar.tsx        (è‡ªå®šä¹‰å·¥å…·æ )
  â”œâ”€â”€ element-inspector.tsx     (å…ƒç´ æ£€æŸ¥å™¨)

lib/canvas/
  â”œâ”€â”€ excalidraw-adapter.ts     (é€‚é…å™¨)
```

---

### 9. è¯­ä¹‰æœç´¢å’Œ AI å¢å¼ºï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~700 è¡Œ

**åŠŸèƒ½**:
- åŸºäºç»‘å®šçš„è¯­ä¹‰æœç´¢
- AI è‡ªåŠ¨å»ºè®®ç»‘å®š
- æ™ºèƒ½æ‘˜è¦ç”Ÿæˆ

**æ–‡ä»¶ç»“æ„**:
```
lib/ai/
  â”œâ”€â”€ semantic-search.ts        (è¯­ä¹‰æœç´¢)
  â”œâ”€â”€ binding-suggester.ts      (ç»‘å®šå»ºè®®)
  â”œâ”€â”€ summarizer.ts             (æ‘˜è¦ç”Ÿæˆ)

app/api/ai/
  â”œâ”€â”€ suggest-bindings/
      â””â”€â”€ route.ts              (å»ºè®®API)
```

---

### 10. å‰ç«¯ç»„ä»¶åº“ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
**ä¼°è®¡ä»£ç è¡Œæ•°**: ~1200 è¡Œ

**åŠŸèƒ½**:
- ç”»å¸ƒä¸»ç»„ä»¶
- ç»‘å®šå¯è§†åŒ–
- å¤åˆèŠ‚ç‚¹UI
- åä½œæŒ‡ç¤ºå™¨

**æ–‡ä»¶ç»“æ„**:
```
components/canvas/
  â”œâ”€â”€ canvas-view.tsx           (ä¸»è§†å›¾)
  â”œâ”€â”€ binding-indicator.tsx     (ç»‘å®šæŒ‡ç¤ºå™¨)
  â”œâ”€â”€ compound-node-badge.tsx   (å¤åˆèŠ‚ç‚¹æ ‡è®°)
  â”œâ”€â”€ collaboration-cursor.tsx  (åä½œå…‰æ ‡)
  â”œâ”€â”€ canvas-minimap.tsx        (ç”»å¸ƒç¼©ç•¥å›¾)
```

---

## ğŸ“Š å®ç°ä¼˜å…ˆçº§å»ºè®®

### é˜¶æ®µ 1: æ ¸å¿ƒåŸºç¡€ï¼ˆç¬¬1-2å‘¨ï¼‰
1. ç”»å¸ƒå…ƒç´ å­˜å‚¨ API
2. å¤åˆèŠ‚ç‚¹ç®¡ç†å™¨
3. Excalidraw é›†æˆå±‚

### é˜¶æ®µ 2: å›¾æ–‡è”åŠ¨ï¼ˆç¬¬3-4å‘¨ï¼‰
4. æ–‡æ¡£-ç”»å¸ƒç»‘å®šç³»ç»Ÿ
5. æ‹–æ‹½ç³»ç»Ÿ
6. äººç±»è£å†³é›†æˆ

### é˜¶æ®µ 3: é«˜çº§åŠŸèƒ½ï¼ˆç¬¬5-6å‘¨ï¼‰
7. å®æ—¶åä½œ
8. è¯­ä¹‰æœç´¢å’Œ AI å¢å¼º

### é˜¶æ®µ 4: UI å®Œå–„ï¼ˆç¬¬7-8å‘¨ï¼‰
9. å‰ç«¯ç»„ä»¶åº“
10. æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### âœ… ç¼–è¾‘å™¨æ‹–æ‹½é›†æˆå·²å®Œæˆï¼

**å®ç°æ–¹å¼**ï¼šShift + æ‹–æ‹½é€‰ä¸­æ–‡å­—

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- âœ… é€‰ä¸­æ–‡å­—æŒ‰ä½ Shift é”®å³å¯æ‹–æ‹½
- âœ… è‡ªåŠ¨æ£€æµ‹æºç±»å‹ï¼ˆæ ‡é¢˜/æ®µè½/ä»£ç ï¼‰
- âœ… ç²¾ç¾çš„æ‹–æ‹½é¢„è§ˆï¼ˆå¸¦å›¾æ ‡å’Œæ¸å˜è‰²ï¼‰
- âœ… æ™ºèƒ½æç¤ºï¼ˆé¦–æ¬¡ä½¿ç”¨ä¼šæ˜¾ç¤ºæç¤ºï¼‰
- âœ… å®Œæ•´çš„è§†è§‰åé¦ˆ

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# å¯åŠ¨é¡¹ç›®
npm run dev

# æ‰“å¼€ä»»æ„æ–‡æ¡£
# 1. é€‰ä¸­ä¸€æ®µæ–‡å­—ï¼ˆ5ä¸ªå­—ç¬¦ä»¥ä¸Šï¼‰
# 2. æŒ‰ä½ Shift é”®
# 3. æ‹–æ‹½åˆ°å³ä¾§ç”»å¸ƒ
# 4. æ¾å¼€å³å¯åˆ›å»ºå…ƒç´ 
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜å…ˆçº§

**åç»­æ¨¡å—**ï¼ˆæŒ‰æ¨èé¡ºåºï¼‰ï¼š

1. **æ•°æ®åº“è¿ç§»** â¬…ï¸ ç«‹å³æ‰§è¡Œ
   - è¿è¡Œ `npx drizzle-kit push` åº”ç”¨ canvas schema
   - å¤„ç† semantic_nodes çš„å”¯ä¸€çº¦æŸå†²çª

2. **æµ‹è¯•å®Œæ•´æµç¨‹** â¬…ï¸ é‡è¦
   - å¯åŠ¨é¡¹ç›®éªŒè¯æ‹–æ‹½åŠŸèƒ½
   - æ£€æŸ¥æ•°æ®åº“ç»‘å®šè®°å½•
   - ä¿®å¤å¯èƒ½çš„ bug

3. **Excalidraw é›†æˆå±‚ä¼˜åŒ–**
   - ç›‘å¬ç”»å¸ƒå…ƒç´ é€‰æ‹©äº‹ä»¶
   - å®ç°å…ƒç´ ç‚¹å‡»é«˜äº®å¯¹åº”æ–‡æ¡£ä½ç½®
   - æ·»åŠ å…ƒç´ ç¼–è¾‘è¿½è¸ª

4. **ç”»å¸ƒå…ƒç´ å­˜å‚¨ API å®Œå–„**
   - å¢é‡æ›´æ–°å’Œé˜²æŠ–ä¿å­˜
   - æ‰¹é‡æ“ä½œä¼˜åŒ–
   - å¤§ç”»å¸ƒåˆ†å—åŠ è½½

5. **å¤åˆèŠ‚ç‚¹ç®¡ç†å™¨**
   - å¤šé€‰å…ƒç´ åˆ›å»ºç»„
   - ç»„ç§»åŠ¨å’Œæ‹†åˆ†
   - åµŒå¥—ç»„æ”¯æŒ

6. **åŒå‘åŒæ­¥ç³»ç»Ÿ**
   - ç”»å¸ƒ â†’ æ–‡æ¡£æ–¹å‘
   - æ–‡æ¡£ä¿®æ”¹æ›´æ–°ç”»å¸ƒ
   - ç»‘å®šå…³ç³»å¯è§†åŒ–

---

## ğŸ’¡ æŠ€æœ¯æ ˆ

- **å‰ç«¯**: React, TypeScript, Excalidraw
- **åç«¯**: Next.js Server Actions, WebSocket
- **æ•°æ®åº“**: PostgreSQL + Drizzle ORM
- **å®æ—¶**: WebSocket + CRDT (Yjsæˆ–è‡ªç ”)
- **AI**: Gemini API (å·²é›†æˆ)

---

## ğŸ“ æ•°æ®åº“è¿ç§»

è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–°è¡¨ï¼š

```bash
# ç”Ÿæˆè¿ç§»
npx drizzle-kit generate:pg

# è¿è¡Œè¿ç§»
npx drizzle-kit push:pg
```

---

## â“ æ¥ä¸‹æ¥åšä»€ä¹ˆï¼Ÿ

**è¯·å‘Šè¯‰æˆ‘ä½ æƒ³ä¼˜å…ˆå®ç°å“ªä¸ªæ¨¡å—**ï¼Œæˆ‘ä¼šæä¾›å®Œæ•´çš„ã€å¯è¿è¡Œçš„ä»£ç å®ç°ã€‚

æ¨èé¡ºåºï¼š
1. Excalidraw é›†æˆå±‚ï¼ˆè®©ç”»å¸ƒèƒ½å·¥ä½œï¼‰
2. æ‹–æ‹½ç³»ç»Ÿï¼ˆæœ€ç›´è§‚çš„åŠŸèƒ½ï¼‰
3. æ–‡æ¡£-ç”»å¸ƒç»‘å®šï¼ˆæ ¸å¿ƒä»·å€¼ï¼‰
